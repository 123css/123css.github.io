<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>php+mysql构建接口增删改查 | 塔塔开的个人博客</title><script>var config = </script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.4.0/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.1.0"></head><body style="background-image:url(https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fdingyue.ws.126.net%2F2020%2F0722%2Ff29a9904p00qdujrl00g4c000sg00g0m.png&amp;refer=http%3A%2F%2Fdingyue.ws.126.net&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1654055511&amp;t=30219f9f8845d6854cdde84e440d84db);"><div id="cursor-container"><div id="cursor-outer"></div><div id="cursor-effect"></div></div><main><header><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><ol class="navContent"><li class="navItem"><a href="/"><span class="navItemTitle">主页</span></a></li><li class="navItem"><a href="/archives/"><span class="navItemTitle">目录</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>php+mysql构建接口增删改查</h1><div id="post-info"><span>First Post:<span class="control"><time datetime="2022-05-02T02:05:19.964Z" id="date"> 2022-05-02</time></span></span><br><span>Last Update:<span class="control"><time datetime="2022-05-02T03:44:02.304Z" id="updated"> 2022-05-02</time></span></span></div></div><hr><div id="post-content"><h1 id="设置数据库"><a href="#设置数据库" class="headerlink" title="设置数据库"></a>设置数据库</h1><p><img src="/2022/05/02/php/database.png"></p>
<h1 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$conn</span> = new mysqli(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;phpcrud&quot;</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$conn</span>-&gt;connect_error) &#123;<br>    die(<span class="hljs-string">&quot;数据库连接失败&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="构建接口"><a href="#构建接口" class="headerlink" title="构建接口"></a>构建接口</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$action</span> = <span class="hljs-string">&quot;read&quot;</span>;  //定义传递过来的参数<br><br>//返回的数据对象<br><span class="hljs-variable">$res</span> = array(<span class="hljs-string">&#x27;error&#x27;</span> =&gt; <span class="hljs-literal">false</span>); //定义接受数据的数组<br><br><span class="hljs-keyword">if</span> (isset(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$action</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>];  //将传递的参数赋值<br>&#125;;<br></code></pre></td></tr></table></figure>

<h2 id="获取数据接口"><a href="#获取数据接口" class="headerlink" title="获取数据接口"></a>获取数据接口</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$action</span> == <span class="hljs-string">&quot;read&quot;</span>) &#123;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;query(<span class="hljs-string">&quot;SELECT * FROM `users`&quot;</span>); //数据库中查询到的数据<br>    <span class="hljs-variable">$users</span> = array(); //定义数据数组<br>    <span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-variable">$result</span>-&gt;fetch_assoc()) &#123; //从结果集中取得一行作为关联数组<br>        array_push(<span class="hljs-variable">$users</span>, <span class="hljs-variable">$row</span>);<br>    &#125;<br>    <span class="hljs-variable">$res</span>[<span class="hljs-string">&#x27;users&#x27;</span>] = <span class="hljs-variable">$users</span>;<br>&#125;;<br></code></pre></td></tr></table></figure>

<h2 id="增加数据接口"><a href="#增加数据接口" class="headerlink" title="增加数据接口"></a>增加数据接口</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$action</span> == <span class="hljs-string">&quot;create&quot;</span>) &#123;<br>    <span class="hljs-variable">$username</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>    <span class="hljs-variable">$email</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>];<br>    <span class="hljs-variable">$wechat</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;wechat&#x27;</span>];<br><br>    <span class="hljs-variable">$conn</span>-&gt;query(<span class="hljs-string">&quot;set names utf8&quot;</span>);<br><br>    //执行sql语句<br>    <span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;query(<span class="hljs-string">&quot;INSERT INTO `users`(`username`,`email`,`wechat`)VALUES (&#x27;<span class="hljs-variable">$username</span>&#x27;,&#x27;<span class="hljs-variable">$email</span>&#x27;,&#x27;<span class="hljs-variable">$wechat</span>&#x27;)&quot;</span>);<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>) &#123;<br>        <span class="hljs-variable">$res</span>[<span class="hljs-string">&quot;message&quot;</span>] = <span class="hljs-string">&quot;User added successfully&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$res</span>[<span class="hljs-string">&#x27;error&#x27;</span>] = <span class="hljs-literal">true</span>;<br>        <span class="hljs-variable">$res</span>[<span class="hljs-string">&quot;message&quot;</span>] = <span class="hljs-string">&quot;User added failed&quot;</span>;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<h2 id="更新数据接口"><a href="#更新数据接口" class="headerlink" title="更新数据接口"></a>更新数据接口</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$action</span> == <span class="hljs-string">&quot;update&quot;</span>) &#123;<br>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br>    <span class="hljs-variable">$username</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>    <span class="hljs-variable">$email</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>];<br>    <span class="hljs-variable">$wechat</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;wechat&#x27;</span>];<br><br>    <span class="hljs-variable">$conn</span>-&gt;query(<span class="hljs-string">&quot;set names utf8&quot;</span>);<br><br>    //执行sql语句<br>    <span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;query(<span class="hljs-string">&quot;UPDATE `users` SET `username` =&#x27;<span class="hljs-variable">$username</span>&#x27; ,`email`=&#x27;<span class="hljs-variable">$email</span>&#x27;,`wechat`=&#x27;<span class="hljs-variable">$wechat</span>&#x27; WHERE `id` = &#x27;<span class="hljs-variable">$id</span>&#x27;&quot;</span>);<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>) &#123;<br>        <span class="hljs-variable">$res</span>[<span class="hljs-string">&quot;message&quot;</span>] = <span class="hljs-string">&quot;User updated successfully&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$res</span>[<span class="hljs-string">&#x27;error&#x27;</span>] = <span class="hljs-literal">true</span>;<br>        <span class="hljs-variable">$res</span>[<span class="hljs-string">&quot;message&quot;</span>] = <span class="hljs-string">&quot;User updated failed&quot;</span>;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<h2 id="删除数据接口"><a href="#删除数据接口" class="headerlink" title="删除数据接口"></a>删除数据接口</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$action</span> == <span class="hljs-string">&quot;delete&quot;</span>) &#123;<br>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br><br>    //执行sql语句<br>    <span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;query(<span class="hljs-string">&quot;DELETE FROM `users` WHERE `id` = &#x27;<span class="hljs-variable">$id</span>&#x27;&quot;</span>);<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>) &#123;<br>        <span class="hljs-variable">$res</span>[<span class="hljs-string">&quot;message&quot;</span>] = <span class="hljs-string">&quot;User deleted successfully&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$res</span>[<span class="hljs-string">&#x27;error&#x27;</span>] = <span class="hljs-literal">true</span>;<br>        <span class="hljs-variable">$res</span>[<span class="hljs-string">&quot;message&quot;</span>] = <span class="hljs-string">&quot;User deleted failed&quot;</span>;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<h1 id="关闭数据库"><a href="#关闭数据库" class="headerlink" title="关闭数据库"></a>关闭数据库</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$conn</span>-&gt;close();<br><br>header(<span class="hljs-string">&quot;Content-type:application/json&quot;</span>);<br></code></pre></td></tr></table></figure>

<h1 id="返回数据"><a href="#返回数据" class="headerlink" title="返回数据"></a>返回数据</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> json_encode(<span class="hljs-variable">$res</span>);<br>die();<br></code></pre></td></tr></table></figure>



<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div id="footer-link" style="right: calc(50% - 1px);order: 1;border-right: 1px solid #fe2;padding-left: unset;max-width: calc(50% - 4px);"><a href="/2022/05/02/%E5%A6%82%E4%BD%95%E5%B0%86hexo%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%8E%A8%E9%80%81%E5%88%B0github%E4%B8%AD/">← Next 如何将hexo个人博客推送到github中</a></div><div id="footer-link" style="left: 50%;order: 0;border-left: 1px solid #fe2;padding-right: unset;max-width: calc(50% - 5px);"><a href="/2022/04/30/%E6%8E%A8%E9%80%81%E9%A1%B9%E7%9B%AE%E5%88%B0github%E4%B8%8A/">如何推送项目到github上 Prev →</a></div></div></div><details id="reward"><summary>打赏</summary><div id="alipay"><span>支付宝 | Alipay</span><br><img src="/img/Alipay.png"></div><div id="wechat"><span>微信 | WeChat</span><br><img src="/img/WeChat.png"></div></details></div><div id="bottom-btn"><a id="to-top" onClick="index.scrolltop();" title="to top" style="opacity: 0; display: none;">∧</a></div></article><div class="aside-box"><aside><div id="aside-top"><div id="about"><a href="/" id="logo"><img src="https://hbimg.huaban.com/2ee04e458da627a06e96d3e0247cc735f8ce5fc722d9e-muEjA0_fw658/format/webp" alt="Logo"></a><h1 id="Dr"><a href="/">塔塔开</a></h1><div id="description"><p></p></div><!--if page.published === undefined--><section id="total"><a id="total-archives" href="/archives"><span class="total-title">Archives Total:</span><span class="total-number">6</span></a><div id="total-tags"><span class="total-title">Tags:</span><span class="total-number">0</span></div><div id="total-categories"><span class="total-title">Categories:</span><span class="total-number">0</span></div></section></div><div id="aside-block"><div id="toc-div"><h1>INDEX</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.</span> <span class="toc-text">设置数据库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.</span> <span class="toc-text">连接数据库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.</span> <span class="toc-text">构建接口</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.1.</span> <span class="toc-text">获取数据接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.2.</span> <span class="toc-text">增加数据接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.3.</span> <span class="toc-text">更新数据接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.4.</span> <span class="toc-text">删除数据接口</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">4.</span> <span class="toc-text">关闭数据库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E6%95%B0%E6%8D%AE"><span class="toc-number">5.</span> <span class="toc-text">返回数据</span></a></li></ol></div></div></div><footer><text>published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></text><text> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight</a></text><wbr><text>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></text></footer></aside></div></main><canvas id="canvas-dust"></canvas><script>const reset=_=>{}</script><script src="//unpkg.com/@highlightjs/cdn-assets@11.4.0/highlight.min.js"></script><script src="/js/arknights.js"></script><script>document.addEventListener("load",reset())</script></body></html>